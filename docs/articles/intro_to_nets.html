<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Time varying ITN usage • hanojoel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Time varying ITN usage">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hanojoel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/run_model.html">Simplest Model Run</a>
    </li>
    <li>
      <a href="../articles/create_r_model.html">More Flexible Model Run</a>
    </li>
    <li>
      <a href="../articles/intro_to_nets.html">Adding ITNs and IRS</a>
    </li>
    <li class="divider">
    <li>
      <a href="../CONTRIBUTING.html">Contributing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/hanojoel">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Time varying ITN usage</h1>
                        <h4 class="author">H. Juliette T. Unwin</h4>
            
            <h4 class="date">2019-05-29</h4>
      
      
      <div class="hidden name"><code>intro_to_nets.Rmd</code></div>

    </div>

    
    
<p>** This is work in progress and is only a very coarse approximate implementation. Speak to OJ or Ettie about ideas on how to improve. **</p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Varying insecticide treated net (ITNs) usage can be modelled with the default deterministic Imperial Malaria model. This is implemented by splitting the population into two different compartments:</p>
<ol style="list-style-type: decimal">
<li>People who don’t use ITNs.</li>
<li>People who use ITNs.</li>
</ol>
<p>Each of these compartments is then modelled separately, with all contributing to a share force of infection from humans to mosquitoes.</p>
<p>The default <code>odin_model.R</code> model, splits the population according to the ITN usage levels. However, this isn’t possible when the usage varys with time. Instead we can edit the equilibrium solution to split the population as desired. This variable is called `pop_split’ and is the percentage of the population in each of the intervention groups at all times. The default is to equally split the population into two so the whole population in one group does not die. This means that care needs to be taken to ensure that any outputs are correctly re-scaled to represent the population split at a given time. For example the prevalence is rescaled according to:</p>
<pre><code># Provides dimentions for the variable
dim(prev0to59) &lt;- c(age59,nh,num_int)
# Computes prevalence in 1-59 month olds.
prev0to59[1:age59,,] &lt;- T[i,j,k]*lagged_cov[k]/pop_split[k] + D[i,j,k]*lagged_cov[k]/pop_split[k]  + A[i,j,k]*lagged_cov[k]/pop_split[k]*p_det[i,j,k]</code></pre>
<p>The coverage is lagged to reflect the lag in liver stage parasitemia. <strong>OJ and Ettie have come up with a better way to do this which has not been coded up yet.</strong></p>
</div>
<div id="implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h2>
<p>Varying ITN usage is modelled by providing two vectors <code>itn_vector</code> and <code>t_vector</code> to the <code>create_r_model</code> function using the <code>odin_model_itn.R</code> version of the model. Here the <code>itn_vector</code> vector dictates how the ITN usage changes and <code>t_vector</code> is the time in days that the usage change at.</p>
<p>The edits to the equilibrium solution are made in a user defined function such as the one below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edit_equilibrium_varying_nets &lt;-<span class="st"> </span><span class="cf">function</span>(wh, population_split){
  <span class="co"># Need to add population split and use to edit initial conditions</span>
  wh<span class="op">$</span>state<span class="op">$</span>pop_split &lt;-<span class="st"> </span>population_split <span class="co"># Population split</span>
  cov &lt;-<span class="st"> </span>wh<span class="op">$</span>mpl<span class="op">$</span>cov

  <span class="co"># This code here only works when IRS is turned off</span>
  <span class="co"># Divide the no intervention compartment by cov[1] to get original eqm soln</span>
  tmp_init_S &lt;-<span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>init_S[,,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>cov[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_S[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp_init_S <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_S[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>tmp_init_S <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">2</span>]
  tmp_init_T &lt;-<span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>init_T[,,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>cov[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_T[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp_init_T <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_T[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>tmp_init_T <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">2</span>]
  tmp_init_D &lt;-<span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>init_D[,,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>cov[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_D[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp_init_D <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_D[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>tmp_init_D <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">2</span>]
  tmp_init_A &lt;-<span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>init_A[,,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>cov[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_A[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp_init_A <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_A[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>tmp_init_A <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">2</span>]
  tmp_init_U &lt;-<span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>init_U[,,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>cov[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_U[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp_init_U <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_U[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>tmp_init_U <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">2</span>]
  tmp_init_P &lt;-<span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>init_P[,,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>cov[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_P[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp_init_P <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_P[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>tmp_init_P <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">2</span>]

  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(wh)
}</code></pre></div>
<p>An example of how the full similation is run is given below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(hanojoel)
<span class="co"># define the net usage </span>
<span class="co"># need to define the coverage in the past so can have a usage using the delay</span>
itn_vector &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>)
t_vector &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">25</span>, <span class="dv">1</span><span class="op">*</span><span class="dv">365</span>, <span class="dv">2</span><span class="op">*</span><span class="dv">365</span>) <span class="co"># number of days at which the itn usage changes</span>
ITN_IRS_on &lt;-<span class="st"> </span>t_vector[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">min</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(itn_vector <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>))] <span class="co"># time at which nets switch on</span>
population_split &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)

<span class="co"># creates the odin model</span>
wh &lt;-<span class="st"> </span>hanojoel<span class="op">:::</span><span class="kw"><a href="../reference/create_r_model.html">create_r_model</a></span>(<span class="dt">odin_model_path =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata/odin_model_itn.R"</span>,
                                                              <span class="dt">package =</span> <span class="st">"hanojoel"</span>),
                                <span class="dt">num_int =</span> <span class="dv">2</span>, 
                                <span class="dt">itn_vector =</span> itn_vector,
                                <span class="dt">t_vector =</span> t_vector,
                                <span class="dt">ITN_IRS_on =</span> ITN_IRS_on)

<span class="co"># edits equilibrium condition with new coverage split.</span>
wh &lt;-<span class="st"> </span><span class="kw">edit_equilibrium_varying_nets</span>(wh, population_split)

<span class="co"># generates model functions with initial state data</span>
mod &lt;-<span class="st"> </span>wh<span class="op">$</span><span class="kw">generator</span>(<span class="dt">user=</span> wh<span class="op">$</span>state, <span class="dt">use_dde =</span> <span class="ot">TRUE</span>)
<span class="co"># Runs the model</span>
mod_run &lt;-<span class="st"> </span>mod<span class="op">$</span><span class="kw">run</span>(<span class="dt">t =</span> <span class="dv">1</span><span class="op">:</span>(<span class="dv">365</span><span class="op">*</span><span class="dv">3</span>))
out &lt;-<span class="st"> </span>mod<span class="op">$</span><span class="kw">transform_variables</span>(mod_run)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(out<span class="op">$</span>t, out<span class="op">$</span>prev, <span class="dt">type=</span><span class="st">'l'</span>, <span class="dt">col=</span><span class="st">'black'</span>, <span class="dt">main=</span><span class="st">'Prevalance'</span>)</code></pre></div>
<p><img src="intro_to_nets_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>At present varing IRS has not been implemented. However, IRS can still be added to the model at a constant level as before. This needs the following additional function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edit_equilibrium_varying_nets_irs &lt;-<span class="st"> </span><span class="cf">function</span>(wh, population_split){
  <span class="co"># Need to add population split and use to edit initial conditions</span>
  wh<span class="op">$</span>state<span class="op">$</span>pop_split &lt;-<span class="st"> </span>population_split <span class="co"># Population split</span>
  cov &lt;-<span class="st"> </span>wh<span class="op">$</span>mpl<span class="op">$</span>cov

  <span class="co"># This code here only works when IRS is turned off</span>
  <span class="co"># Divide the no intervention compartment by cov[1] to get original eqm soln</span>
  tmp_init_S &lt;-<span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>init_S[,,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>cov[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_S[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp_init_S <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_S[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>tmp_init_S <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">2</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_S[,,<span class="dv">3</span>] &lt;-<span class="st"> </span>tmp_init_S <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">3</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_S[,,<span class="dv">4</span>] &lt;-<span class="st"> </span>tmp_init_S <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">4</span>]
  tmp_init_T &lt;-<span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>init_T[,,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>cov[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_T[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp_init_T <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_T[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>tmp_init_T <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">2</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_T[,,<span class="dv">3</span>] &lt;-<span class="st"> </span>tmp_init_T <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">3</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_T[,,<span class="dv">4</span>] &lt;-<span class="st"> </span>tmp_init_T <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">4</span>]
  tmp_init_D &lt;-<span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>init_D[,,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>cov[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_D[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp_init_D <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_D[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>tmp_init_D <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">2</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_D[,,<span class="dv">3</span>] &lt;-<span class="st"> </span>tmp_init_D <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">3</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_D[,,<span class="dv">4</span>] &lt;-<span class="st"> </span>tmp_init_D <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">4</span>]
  tmp_init_A &lt;-<span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>init_A[,,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>cov[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_A[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp_init_A <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_A[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>tmp_init_A <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">2</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_A[,,<span class="dv">3</span>] &lt;-<span class="st"> </span>tmp_init_A <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">3</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_A[,,<span class="dv">4</span>] &lt;-<span class="st"> </span>tmp_init_A <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">4</span>]
  tmp_init_U &lt;-<span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>init_U[,,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>cov[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_U[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp_init_U <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_U[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>tmp_init_U <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">2</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_U[,,<span class="dv">3</span>] &lt;-<span class="st"> </span>tmp_init_U <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">3</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_U[,,<span class="dv">4</span>] &lt;-<span class="st"> </span>tmp_init_U <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">4</span>]
  tmp_init_P &lt;-<span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>init_P[,,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>cov[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_P[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp_init_P <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">1</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_P[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>tmp_init_P <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">2</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_P[,,<span class="dv">3</span>] &lt;-<span class="st"> </span>tmp_init_P <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">3</span>]
  wh<span class="op">$</span>state<span class="op">$</span>init_P[,,<span class="dv">4</span>] &lt;-<span class="st"> </span>tmp_init_P <span class="op">*</span><span class="st"> </span>wh<span class="op">$</span>state<span class="op">$</span>pop_split[<span class="dv">4</span>]

  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(wh)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(hanojoel)
<span class="co"># define the net usage </span>
<span class="co"># need to define the coverage in the past so can have a usage using the delay</span>
itn_vector &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>)
t_vector &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">25</span>, <span class="dv">1</span><span class="op">*</span><span class="dv">365</span>, <span class="dv">2</span><span class="op">*</span><span class="dv">365</span>) <span class="co"># number of days at which the itn usage changes</span>
ITN_IRS_on &lt;-<span class="st"> </span>t_vector[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">min</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(itn_vector <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>))] <span class="co"># time at which nets switch on</span>
population_split &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>)

<span class="co"># creates the odin model</span>
wh &lt;-<span class="st"> </span>hanojoel<span class="op">:::</span><span class="kw"><a href="../reference/create_r_model.html">create_r_model</a></span>(<span class="dt">odin_model_path =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata/odin_model_itn.R"</span>,
                                                              <span class="dt">package =</span> <span class="st">"hanojoel"</span>),
                                <span class="dt">num_int =</span> <span class="dv">4</span>, 
                                <span class="dt">itn_vector =</span> itn_vector,
                                <span class="dt">t_vector =</span> t_vector,
                                <span class="dt">irs_cov =</span> <span class="fl">0.2</span>,
                                <span class="dt">ITN_IRS_on =</span> ITN_IRS_on)

<span class="co"># edits equilibrium condition with new coverage split.</span>
wh &lt;-<span class="st"> </span><span class="kw">edit_equilibrium_varying_nets_irs</span>(wh, population_split)

<span class="co"># generates model functions with initial state data</span>
mod &lt;-<span class="st"> </span>wh<span class="op">$</span><span class="kw">generator</span>(<span class="dt">user=</span> wh<span class="op">$</span>state, <span class="dt">use_dde =</span> <span class="ot">TRUE</span>)
<span class="co"># Runs the model</span>
mod_run &lt;-<span class="st"> </span>mod<span class="op">$</span><span class="kw">run</span>(<span class="dt">t =</span> <span class="dv">1</span><span class="op">:</span>(<span class="dv">365</span><span class="op">*</span><span class="dv">3</span>))
out &lt;-<span class="st"> </span>mod<span class="op">$</span><span class="kw">transform_variables</span>(mod_run)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(out<span class="op">$</span>t, out<span class="op">$</span>prev, <span class="dt">type=</span><span class="st">'l'</span>, <span class="dt">col=</span><span class="st">'black'</span>, <span class="dt">main=</span><span class="st">'Prevalance'</span>)</code></pre></div>
<p><img src="intro_to_nets_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#implementation">Implementation</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Joel Hellewell, Hannah Slater, Juliette Unwin, OJ Watson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
